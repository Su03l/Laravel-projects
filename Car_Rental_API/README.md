# واجهة برمجة تطبيقات نظام تأجير السيارات

واجهة برمجة تطبيقات RESTful قوية لإدارة أعمال تأجير السيارات، مبنية باستخدام Laravel. تتميز بحساب تلقائي للتكاليف، وإدارة صارمة لحالة المركبات، وسلامة البيانات المعاملاتية.

## المميزات الرئيسية

-   **إدارة الأسطول:** عمليات CRUD كاملة للسيارات مع تتبع الحالة (`متاح`، `مؤجر`، `صيانة`).
-   **إدارة العملاء:** إدارة ملفات العملاء مع فحص الهوية الفريدة.
-   **منطق التأجير:**
    -   **الفوترة التلقائية:** حساب تلقائي للتكلفة الإجمالية بناءً على مدة الإيجار والسعر اليومي.
    -   **إدارة الحالة:** تبديل تلقائي لحالة السيارة إلى `مؤجر` عند الحجز وإلى `متاح` عند الإرجاع.
    -   **منع التعارضات:** منع حجز المركبات المؤجرة حالياً أو غير المتاحة.
-   **معاملات قاعدة البيانات:** ضمان اتساق البيانات عبر جميع عمليات التأجير (الإيجار، الإرجاع، الإلغاء).

## التقنيات المستخدمة

-   **Laravel:** إطار عمل PHP الأساسي.
-   **SQLite:** قاعدة البيانات (التطوير).
-   **Carbon:** معالجة التواريخ وحساب المدة.

## نقاط النهاية (API Endpoints)

### السيارات

1. **عرض جميع السيارات**
    - `GET /api/cars`
2. **إضافة سيارة جديدة**
    - `POST /api/cars`
    - **Body:**
        ```json
        {
            "name": "Toyota Camry",
            "model_year": "2024",
            "license_plate": "KSA-2030",
            "daily_price": 250.0
        }
        ```
3. **تحديث سيارة**
    - `PUT /api/cars/{id}`
4. **حذف سيارة**
    - `DELETE /api/cars/{id}`
    - _ملاحظة: لا يمكن حذف سيارة مؤجرة حالياً._

### العملاء

1. **عرض جميع العملاء**
    - `GET /api/customers`
2. **تسجيل عميل**
    - `POST /api/customers`
    - **Body:**
        ```json
        {
            "name": "Suliman Yousef",
            "national_id": "1001001001",
            "phone": "0555555555"
        }
        ```

### الإيجارات (المنطق الأساسي)

#### 1. إنشاء عقد إيجار (تأجير سيارة)

ينشئ عقداً جديداً، يحسب التكلفة الإجمالية، ويقفل السيارة (يضبط الحالة إلى `مؤجر`).

-   **URL:** `/api/rentals`
-   **Method:** `POST`
-   **Body:**
    ```json
    {
        "car_id": 1,
        "customer_id": 1,
        "start_date": "2025-12-30",
        "end_date": "2026-01-05"
    }
    ```
-   **Response:**
    ```json
    {
        "message": "Rental created successfully",
        "total_cost": 1500.0,
        "status": "active"
    }
    ```

#### 2. إرجاع السيارة (إغلاق العقد)

يحدد العقد كمكتمل ويفتح قفل السيارة (يعيد الحالة إلى `متاح`).

-   **URL:** `/api/rentals/{id}/return`
-   **Method:** `POST`

#### 3. إلغاء العقد (حذف)

يحذف العقد ويستعيد حالة السيارة إلى `متاح` إذا كان العقد نشطاً.

-   **URL:** `/api/rentals/{id}`
-   **Method:** `DELETE`

#### 4. تحديث العقد

يحدث التواريخ ويعيد حساب التكلفة الإجمالية تلقائياً.

-   **URL:** `/api/rentals/{id}`
-   **Method:** `PUT`

## التثبيت

1. **استنساخ المستودع:**

    ```bash
    git clone <repository-url>
    ```

2. **تثبيت الحزم:**

    ```bash
    composer install
    ```

3. **تكوين البيئة:**

    ```bash
    cp .env.example .env
    # قم بتكوين قاعدة البيانات في .env
    ```

4. **توليد المفتاح:**

    ```bash
    php artisan key:generate
    ```

5. **تشغيل الهجرات والبذور:** (سينشئ سيارات وعملاء تجريبية)

    ```bash
    php artisan migrate --seed
    ```

6. **تشغيل التطبيق:**
    ```bash
    php artisan serve
    ```

## الترخيص

هذا المشروع مرخص تحت ترخيص MIT.

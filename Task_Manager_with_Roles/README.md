# نظام إدارة المهام والصلاحيات (Task Manager API with RBAC)

نظام واجهة برمجية (API) متقدم يحاكي الأنظمة المؤسسية، يركز بشكل أساسي على **إدارة الصلاحيات (Authorization)** وتوزيع الأدوار بين **المدير (Admin)** و**الموظف (User)**. يستخدم المشروع **Laravel Policies** لفصل منطق الحماية، مما يضمن أمان البيانات وخصوصيتها بناءً على رتبة المستخدم.

## أبرز المميزات

-   **نظام الرتب (Role-Based Access Control):**
    -   **المدير (Admin):** يمتلك صلاحيات مطلقة (God Mode) لإدارة المهام والمستخدمين.
    -   **الموظف (User):** صلاحيات محدودة (Scoped Access) تقتصر على بياناته الخاصة.
-   **سياسات الحماية (Policies):** استخدام Laravel Policies لحماية جميع العمليات (CRUD) في الخلفية.
-   **إدارة المستخدمين:** لوحة تحكم خاصة بالمدير لإضافة، تعديل، أو فصل الموظفين.
-   **مجال الرؤية الذكي:**
    -   عند طلب المهام، المدير يرى مهام الجميع.
    -   الموظف يرى مهامه فقط.

## مصفوفة الصلاحيات (Permissions Matrix)

يوضح الجدول التالي ما يمكن لكل رتبة فعله في النظام:

| الإجراء (Action)     | المدير (Admin)    | الموظف (User)   |
| :------------------- | :---------------- | :-------------- |
| **عرض كل المهام**    | مسموح             | (يرى مهامه فقط) |
| **إنشاء مهمة**       | مسموح             | مسموح           |
| **تعديل مهمة**       | أي مهمة           | مهامه فقط       |
| **حذف مهمة**         | أي مهمة           | ممنوع           |
| **إدارة المستخدمين** | (عرض، تعديل، حذف) | ممنوع نهائياً   |

## التقنيات المستخدمة

-   **Laravel 10/11**
-   **Sanctum** (Token Based Authentication)
-   **Policies & Gates** (Authorization Logic)
-   **Database Seeding** (For Testing Roles)

## نقاط الوصول (API Endpoints)

### المصادقة (Auth)

| الطريقة | الرابط          | الوصف                        |
| :------ | :-------------- | :--------------------------- |
| `POST`  | `/api/register` | تسجيل موظف جديد (Role: User) |
| `POST`  | `/api/login`    | تسجيل الدخول                 |
| `POST`  | `/api/logout`   | تسجيل الخروج                 |

### إدارة المستخدمين (Users)

_ملاحظة: هذه الروابط متاحة للمدير (Admin) فقط، باستثناء عرض الملف الشخصي._

| الطريقة  | الرابط            | الوصف                           |
| :------- | :---------------- | :------------------------------ |
| `GET`    | `/api/users`      | عرض قائمة الموظفين (Admin Only) |
| `GET`    | `/api/users/{id}` | عرض تفاصيل موظف                 |
| `PUT`    | `/api/users/{id}` | تعديل بيانات/رتبة موظف          |
| `DELETE` | `/api/users/{id}` | حذف حساب موظف (Admin Only)      |

### إدارة المهام (Tasks)

| الطريقة  | الرابط            | الوصف                     |
| :------- | :---------------- | :------------------------ |
| `GET`    | `/api/tasks`      | عرض المهام (حسب الصلاحية) |
| `POST`   | `/api/tasks`      | إنشاء مهمة جديدة          |
| `PUT`    | `/api/tasks/{id}` | تحديث الحالة/التفاصيل     |
| `DELETE` | `/api/tasks/{id}` | حذف المهمة (Admin Only)   |

## التثبيت والتشغيل (Local Setup)

### 1. نسخ المستودع وتثبيت الحزم:

```bash
git clone <repo-url>
cd Task_Manager_with_Roles
composer install
```

### 2. إعداد البيئة:

```bash
cp .env.example .env
php artisan key:generate
```

_(قم بضبط إعدادات قاعدة البيانات في ملف `.env`)_

### 3. بناء الجداول وزراعة البيانات:

**هذا الأمر سينشئ حساب "مدير" وحساب "موظف" للتجربة.**

```bash
php artisan migrate --seed
```

**بيانات الدخول للتجربة (Test Credentials):**

-   **المدير:** `admin@app.com` / `password`
-   **الموظف:** `user@app.com` / `password`

### 4. تشغيل السيرفر:

```bash
php artisan serve
```

## أمثلة الاستخدام

### تسجيل الدخول كمدير:

```bash
POST /api/login
{
    "email": "admin@app.com",
    "password": "password"
}
```

### إنشاء مهمة جديدة:

```bash
POST /api/tasks
Authorization: Bearer {token}
{
    "title": "إنجاز التقرير الشهري",
    "description": "إعداد تقرير الأداء للشهر الحالي",
    "status": "pending"
}
```

### عرض جميع المهام (كمدير):

```bash
GET /api/tasks
Authorization: Bearer {admin_token}
```

## الترخيص

هذا المشروع مرخص تحت [ترخيص MIT](https://opensource.org/licenses/MIT).
